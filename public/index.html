<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Intelligence Level-4+</title>
    <style>
        :root {
            --bg-color: #0d1117;
            --card-bg: #161b22;
            --text-main: #c9d1d9;
            --text-muted: #8b949e;
            --accent-green: #238636;
            --accent-red: #da3633;
            --accent-yellow: #d29922;
            --border: #30363d;
            --btn-active: #1f6feb;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 600px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 20px;
        }

        h1 {
            margin: 0;
            font-size: 1.5rem;
            color: #fff;
        }

        .session-tag {
            display: inline-block;
            background-color: var(--border);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 10px;
            color: var(--text-muted);
        }

        /* Timeframe Buttons */
        .tf-container {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tf-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .tf-btn.active {
            background-color: var(--btn-active);
            color: white;
            border-color: var(--btn-active);
        }

        /* Dashboard Grid */
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .value {
            font-size: 1.1rem;
            font-weight: bold;
        }

        .value.green {
            color: #3fb950;
        }

        .value.red {
            color: #f85149;
        }

        /* Signal Box */
        .signal-box {
            text-align: center;
            padding: 30px;
            font-size: 2rem;
            font-weight: 800;
            border: 2px solid var(--border);
            border-radius: 12px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            transition: background 0.5s;
        }

        .signal-buy {
            background: rgba(35, 134, 54, 0.2);
            border-color: var(--accent-green);
            color: #3fb950;
        }

        .signal-sell {
            background: rgba(218, 54, 51, 0.2);
            border-color: var(--accent-red);
            color: #f85149;
        }

        .signal-wait {
            background: rgba(210, 153, 34, 0.1);
            border-color: var(--accent-yellow);
            color: var(--accent-yellow);
        }

        .prob-bar-container {
            height: 10px;
            background: var(--border);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
            display: flex;
        }

        .prob-bar {
            height: 100%;
            transition: width 0.5s ease;
        }

        .prob-buy {
            background-color: var(--accent-green);
        }

        .prob-sell {
            background-color: var(--accent-red);
        }

        .loader {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 20px;
        }

        /* Matrix Styles */
        .matrix-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .matrix-title {
            text-align: center;
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }

        .matrix-row {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .matrix-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 50px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border: 1px solid var(--border);
            font-size: 0.8rem;
            font-weight: bold;
        }

        .matrix-box.buy {
            background: rgba(35, 134, 54, 0.2);
            border-color: var(--accent-green);
            color: #3fb950;
        }

        .matrix-box.sell {
            background: rgba(218, 54, 51, 0.2);
            border-color: var(--accent-red);
            color: #f85149;
        }

        .matrix-box.wait {
            background: rgba(139, 148, 158, 0.1);
            color: var(--text-muted);
        }

        .align-text {
            text-align: center;
            font-weight: bold;
            font-size: 1rem;
            margin-top: 5px;
            color: #fff;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="header">
            <h1>Gold Intelligence AI</h1>
            <div id="session-tag" class="session-tag">Loading Session...</div>
        </div>

        <!-- God Mode Matrix -->
        <div class="matrix-container">
            <div class="matrix-title">GOD MODE ALIGNMENT</div>
            <div class="matrix-row">
                <div id="box-5m" class="matrix-box wait">
                    <span>5M</span>
                    <span class="state">...</span>
                </div>
                <div id="box-1h" class="matrix-box wait">
                    <span>1H</span>
                    <span class="state">...</span>
                </div>
                <div id="box-4h" class="matrix-box wait">
                    <span>4H</span>
                    <span class="state">...</span>
                </div>
            </div>
            <div id="align-text" class="align-text">LOADING...</div>
        </div>

        <!-- Timeframes -->
        <div class="tf-container">
            <button class="tf-btn" onclick="setTF('1m')">1m</button>
            <button class="tf-btn active" onclick="setTF('5m')">5m</button>
            <button class="tf-btn" onclick="setTF('15m')">15m</button>
            <button class="tf-btn" onclick="setTF('1H')">1H</button>
            <button class="tf-btn" onclick="setTF('4H')">4H</button>
            <button class="tf-btn" onclick="setTF('1D')">1D</button>
            <button class="tf-btn" onclick="setTF('1W')">1W</button>
        </div>

        <div id="signal-box" class="signal-box signal-wait">
            INITIALIZING...
        </div>

        <div class="card">
            <div class="row">
                <span class="label">BUY CONFIDENCE</span>
                <span id="prob-buy-text" class="value green">0%</span>
            </div>
            <div class="prob-bar-container">
                <div id="bar-buy" class="prob-bar prob-buy" style="width: 0%"></div>
            </div>

            <div class="row" style="margin-top: 15px;">
                <span class="label">SELL CONFIDENCE</span>
                <span id="prob-sell-text" class="value red">0%</span>
            </div>
            <div class="prob-bar-container">
                <div id="bar-sell" class="prob-bar prob-sell" style="width: 0%"></div>
            </div>
        </div>

        <div class="card">
            <div class="row">
                <span class="label">REGIME</span>
                <span id="regime-text" class="value">Loading...</span>
            </div>
            <div class="row">
                <span class="label">BIAS STRENGTH</span>
                <span id="bias-text" class="value">...</span>
            </div>
            <div class="row" style="margin-top: 10px;">
                <span class="label">DXY (Dol) Speed</span>
                <span id="dxy-delta" class="value">...</span>
            </div>
            <div class="row" style="margin-top: 10px;">
                <span class="label">Gold Snapshot</span>
                <span id="gold-price" class="value">...</span>
            </div>
        </div>

        <div class="loader">
            Auto-updating every ~1s... <span id="last-update"></span>
        </div>

    </div>

    <script>
        let currentTF = '5m';

        function setTF(tf) {
            currentTF = tf;
            // Update Buttons
            document.querySelectorAll('.tf-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.innerText === tf) btn.classList.add('active');
            });
            // Force Refresh
            document.getElementById('signal-box').innerText = "Loading...";
            fetchData();
        }

        async function fetchData() {
            try {
                const response = await fetch(`/api/status?interval=${currentTF}`);
                const data = await response.json();
                updateUI(data);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        function updateMatrixBox(id, signal) {
            const el = document.getElementById(id);
            const state = el.querySelector('.state');

            el.className = 'matrix-box'; // Reset
            let shortSig = "WAIT";
            if (signal.includes("BUY")) {
                el.classList.add("buy");
                shortSig = "BUY";
            } else if (signal.includes("SELL")) {
                el.classList.add("sell");
                shortSig = "SELL";
            } else {
                el.classList.add("wait");
                shortSig = "WAIT";
            }
            // If locked
            if (signal.includes("LOCKED")) shortSig = "LOCK";

            state.innerText = shortSig;
        }

        function updateUI(data) {
            document.getElementById('session-tag').innerText = `ðŸŒ ${data.session.name} (Dubai Time)`;

            // Matrix Update
            if (data.matrix) {
                updateMatrixBox('box-5m', data.matrix.slots['5m']);
                updateMatrixBox('box-1h', data.matrix.slots['1H']);
                updateMatrixBox('box-4h', data.matrix.slots['4H']);
                document.getElementById('align-text').innerText = data.matrix.alignment;
            }

            const signalBox = document.getElementById('signal-box');
            const sig = data.engine.signal;
            signalBox.innerText = sig;
            signalBox.className = 'signal-box';

            if (sig.includes('BUY')) signalBox.classList.add('signal-buy');
            else if (sig.includes('SELL')) signalBox.classList.add('signal-sell');
            else signalBox.classList.add('signal-wait');

            const buyP = data.engine.probs.buy;
            const sellP = data.engine.probs.sell;

            document.getElementById('prob-buy-text').innerText = buyP + '%';
            document.getElementById('bar-buy').style.width = buyP + '%';

            document.getElementById('prob-sell-text').innerText = sellP + '%';
            document.getElementById('bar-sell').style.width = sellP + '%';

            // New Regex/Lock Logic
            const lockStatus = data.engine.lock ? "ðŸ”’ LOCKED" : "ðŸ”“ OPEN";
            document.getElementById('regime-text').innerText = `${data.engine.regime} ${lockStatus}`;

            // Bias Strength logic from Level-5+ formatted report scan or manual logic check
            // Since API doesn't send "bias_strength" explicit key in JSON (only in formatted_report string), 
            // we can parse it or just infer from score.
            let bias = "Weak";
            if (buyP > 75 || sellP > 75) bias = "Strong";
            else if (buyP > 65 || sellP > 65) bias = "Moderate";
            document.getElementById('bias-text').innerText = bias;

            const dxyD = data.engine.data.dxy_delta;
            const dxyEl = document.getElementById('dxy-delta');
            dxyEl.innerText = (dxyD > 0 ? '+' : '') + dxyD;
            dxyEl.className = 'value ' + (dxyD < 0 ? 'green' : 'red');

            document.getElementById('gold-price').innerText = data.engine.data.gold;
            document.getElementById('last-update').innerText = data.timestamp;
        }

        // Interval
        fetchData();
        setInterval(fetchData, 1100); 
    </script>

</body>

</html>